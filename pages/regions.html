<div id="regions">
    
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-1"><input placeholder="Name Search" type="search" ng-model="search.name" style="width: 10em"></div>
            <div class="col-md-1"><input placeholder="Estate Search" type="search" ng-model="search.estateName" style="width: 10em" typeahead="estate.name for estate in estates"></div>
            <div class="col-md-1">
                <select ng-model="search.isRunning">
                    <option value="">All Regions</option>
                    <option value="true">Running</option>
                    <option value="false">Stopped</option>
                </select>
            </div>
            <div class="col-md-4">
                Showing {{(regions|filter:search).length}} of {{regions.length}} Region(s)
            </div>
            <div class="col-md-1"><input ng-if="auth.activeUser.accessLevel > 249" placeholder="host search" ng-model="search.node"></input></div>
            <div class="col-md-4">
                <button data-bind="click: $root.startListedRegions">Start Listed</button>
                <button data-bind="click: $root.stopListedRegions">Stop Listed</button>
                <button data-bind="click: $root.createNewRegion">Add Region</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1">Name</div>
            <div class="col-md-1">Estate</div>
            <div class="col-md-1">Timestamp</div>
            <div class="col-md-1">CPU</div>
            <div class="col-md-1">MEM</div>
            <div class="col-md-1">Uptime</div>
            <div class="col-md-1">Users</div>
            <div class="col-md-1"><span style="float: left; width: 10em" ng-if="auth.activeUser.accessLevel > 249">Host</span></div>
        </div>
        <div class="row" ng-repeat="r in regions | orderBy:['estateName','name'] | filter:search track by r.uuid" ng-class-odd="'odd'" ng-class-even="'even'">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-1"><button popover-trigger="mouseenter" popover-placement="right" popover="View logs for {{r.name}}" ng-click="region.viewLog(r)" class="btn btn-xs btn-default">{{r.name}}</button></div>
                    <div class="col-md-1">{{r.estateName.substring(0,15)}}</div>
                    <div ng-if="r.isRunning" class="col-md-1">{{lastSeen(r.stat.timestamp)}}</div>
                    <div ng-if="r.isRunning" class="col-md-1">{{r.stat.status["cpuPercent"].toFixed(2)}}%</div>
                    <div ng-if="r.isRunning" class="col-md-1">{{r.stat.status["memPercent"].toFixed(2)}} % [{{(r.stat.status["memKB"]/1024).toFixed(2)}} MB]</div>
                    <div ng-if="r.isRunning" class="col-md-1">{{r.stat.status.simStats['Uptime'].split(".").slice(0,-1).join(" days ")}}</div>
                    <div ng-if="r.isRunning" class="col-md-1">{{r.stat.status.simStats['RootAg']}}</div>
                    <div class="col-md-5" ng-if="!r.isRunning">Is not running...</div>
                    <div class="col-md-1"><span ng-if="auth.activeUser.accessLevel > 249">{{hostInfo(r.node)}}</span>&nbsp</div>
                    <div class="col-md-4">
                        <button ng-disabled="region.isRunning" class="ui-button">Start</button>
                        <button ng-disabled="!region.isRunning">Stop</button>
                        <button ng-click="collapse.toggle(r.name+'Content')" ng-disabled="!region.isRunning">Content</button>
                        <button ng-click="collapse.toggle(r.name+'Manage')" ng-disabled="auth.activeUser.accessLevel < 250">Manage</button>
                    </span>
                </div>
                <div class="row" collapse="collapse.current != (r.name+'Manage')">
                    <div class="col-md-1"></div>
                    <div class="col-md-8" ng-if="r.isRunning">
                        manage Online
                    </div>
                    <div class="col-md-8" ng-if="!r.isRunning">
                        <div class="row">
                            <div class ="col-md-2"><button><strike>Delete {{r.name}}</strike></button></div>
                            <div class ="col-md-5">
                                Change Estate
                                <select ng-model="newEstate" ng-options="e.name for e in estates | orderBy: 'name' track by e.name"></select>
                                <button ng-click="region.setEstate(r, newEstate)">Set</button>
                            </div>
                            <div class ="col-md-5">Change Host<select ng-model="newHost" ng-options="h.name+'|'+h.address for h in hosts | orderBy: 'name' track by h.address"></select>
                            <button ng-click="region.setHost(r, newHost)">Set</button></div>
                        </div>
                    </div>
                    <!-- offline:   delete region, change host, change estate
                         online:    rest console
                    -->
                </div>
                <div class="row" collapse="collapse.current != (r.name+'Content')">
                    <div class="col-md-2">&nbsp</div>
                    <div class="col-md-2">content</div>
                    <!-- running ony -->
                </div>
            </div>
        </div>
    </div>
</div>
